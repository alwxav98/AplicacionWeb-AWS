name: Deploy to EC2

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: SSH to EC2 and update the app
      run: |
        ssh -o StrictHostKeyChecking=no ubuntu@${{ secrets.EC2_PUBLIC_IP }} << 'EOF'
         
          cd /path/to/your/app

          
          git pull origin main

          
          if [ ! -f "requirements.txt" ]; then
            echo "requirements.txt no encontrado"
            exit 1
          fi

          
          if [ ! -d "venv" ]; then
            python3 -m venv venv
          fi

          
          source venv/bin/activate

         
          pip install -r requirements.txt

          
          sudo systemctl restart apache2
        EOF
           
            source venv/bin/activate
            pip install -r requirements.txt

            
            sudo systemctl restart apache2
          EOF
